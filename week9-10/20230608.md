# 【日報：6/8(木)】
## 本日の目標（TODO目標/できるようになりたいこと）
- 『コードレビューで学ぶ Ruby on Rails』を読む
## 学習時間（Hour）
- 7h
## 目標振り返り（TODO進捗/できるようになりたいこと振り返り）
- 第2章まで読了
## 詰まっていること（実現したいこと/現状/行ったこと/仮説）
- 特になし
## 学んだこと（新しい気付き、学び）
- 1 Model
  - 1.1 中間テーブルのモデルは「関係性」を表す命名をする
    - ×：(構造を表現) UserMagazine モデル
    - ○：(関係性を表現) Subscription モデル、Favorite モデル
  - 1.2 一般ユーザーと管理者ユーザーは基本的には分けるべき?
    - セキュリティー、要件の違い があるため、分けた方が良い
    - ただし、一般ユーザが管理者に昇格する仕組みがある場合は同じモデルにするメリットは大きい
  - 1.3 default_scope は使わない
    - default_scope を外す際に使用する unscope によって、default_scope 以外の絞り込み条件まで解除されてしまうから。
    - 代わりに「scope」で独自のクエリ用メソッドを作成する(例：default_order (デフォルトの並び順), recent (作成日順)など)。
  - 1.4 デフォルト値の定義には attribute メソッドを使おう
    - 列挙型の属性を扱う gem enumerize を使用し、かつデフォルト値を指定したい場合は、代わりに Rails 標準の attribute メソッドを用いてデフォルト値を設定するべきである。それにより、既存レコードが enumerize で指定した範囲外の値や NULL の場合にデフォルト値によって上書きされてしまう、という事態を防ぐことができる。
  - 1.5 マイグレーションの中でモデルを参照しない
    - カラムの追加に伴うDB内のデータ修正などの際に、カラム追加のために作成したマイグレーションファイルの中において、モデルを参照する形でデータ修正を行うべきではない。参照するモデルやメソッドが将来も存在しているとは限らないので、マイグレーションが失敗するリスクが常に存在することになる。
    - 対策：マイグレーションファイルの中にて、モデルを参照する代わりにSQLを使用してデータを修正する。
    - 対策：データ修正用のスクリプトを、マイグレーションファイルとは別に作成する。
  - 1.6 データベースに制約を設定する
    - バリデーションだけではなく、データベースにも制約を設定する(NOT NULL制約、ユニークインデックス など)。それにより、データの整合性を保つだけではなく、コードもシンプルになる。
    - 既存のテーブルにカラムを追加する場合でも、デフォルト値を用いることで NOT NULL制約を設定可能。
    - NULL と空文字('')を区別する必要のない文字列カラムの場合は、「NOT NULL制約 (null: false)」と「空文字のデフォルト値 (default: '')」を設定するとよい。
  - 1.7 トランザクションを使ってデータ整合性を守る
    - 複数レコードの更新処理はトランザクションで囲む(失敗時に例外を投げる create!, update! などのメソッドを用いる)。
    - 関連を用いたレコードを一括保存する場合は、トランザクションが自動で適用されている。
- 2 View
  - 2.1 ビューに複雑なロジックを書かない
    - テストしにくく、メンテナンスコストがかかる
    - 対策：複雑なロジックは以下のうちの適切な場所に移して、ビューには処理結果のみを表示する
      - ActionView ヘルパー (app/helpers)
      - Model (viewに関係しすぎている処理の場合はModelには書かない。その場合はActionViewヘルパーか Decorator。)
      - Decorator (Reactコンポーネントのpropsに渡すJSONを返すメソッドなど)
      - ViewComponent (viewとそれに関連するロジックを一緒に管理できるgem)
  - 2.2 ビューのレイアウトファイルを分割する
    - ユーザの種類(一般/管理者)によってビューのデザインを変更する場合、「layoutファイル」を分割し、それに伴い「controller」も別々に用意すると良い。以下は例。
      - Controller
        - app/controller/users/application_controller.rb
        - app/controller/admins/application_controller.rb
      - Layout
        - app/views/layouts/users.html.erb
        - app/views/layouts/admins.html.erb
  - 2.3 パーシャルのルート要素にマージンを使わない
    - partial の子側(render で呼ばれる側)に margin を使わずに、親側(呼び出し側)にマージンを設定する。
    - 子コンポーネントが親コンポーネントのレイアウトスタイルに作用しないようにする事は、パーシャルに限らずReactなどのコンポーネント設計でも同じ。
  - 2.4 時間、日付のフォーマットには i18n.l を使おう
    - config/locales/ja.yml の設定に従って表示してくれる
    - 例 ）`<%= I18n.localize task.created_at %>`
    - エイリアス ）`<%= l task.created_at %>`
## 感想（一日の感想、雑談）
- すぐにいかせそうな部分も多々あったのでオリジナルプロダクトに取り入れたい
## 明日の目標（TODO目標/できるようになりたいこと）
- 『コードレビューで学ぶ Ruby on Rails』を読み進める
